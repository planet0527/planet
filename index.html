<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>„Åì„Å®„ÅÆ„ÅØË®∫Êñ≠</title>
  <style>
    body {
      font-family: "Hiragino Kaku Gothic ProN", sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
      color: #333;
    }
    #app {
      max-width: 600px;
      margin: auto;
    }
    button {
      display: block;
      width: 100%;
      margin: 10px 0;
      padding: 12px;
      font-size: 1rem;
      background-color: #ffffff;
      border: 1px solid #ccc;
      border-radius: 8px;
      cursor: pointer;
    }
    button:hover {
      background-color: #e0f7fa;
    }
    @media screen and (max-width: 480px) {
      body {
        padding: 10px;
      }
      button {
        font-size: 0.95rem;
        padding: 10px;
      }
      h1, h2 {
        font-size: 1.2rem;
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <h1>„Åì„Å®„ÅÆ„ÅØË®∫Êñ≠</h1>
    <div id="start-container">
      <button id="start-button">Ë®∫Êñ≠„Çí„ÅØ„Åò„ÇÅ„Çã</button>
    </div>
    <div id="question-container" style="display:none;"></div>
    <button id="next-button" style="display:none">Ê¨°„Å∏</button>
    <button id="history-button">Â±•Ê≠¥„ÇíË¶ã„Çã</button>
    <div id="result-container" style="display:none;"></div>
    <div id="history-container" style="display:none;"></div>
  </div>

  <script>
    const questions = [
      {
        text: "‰ªä„ÅÆ„ÅÇ„Å™„Åü„ÅÆ„ÄéÂøÉ„ÅÆËâ≤„Äè„ÅØÔºü",
        choices: [
          { text: "Êõá„Çä„Åå„Åã„Å£„ÅüÈùí", tags: ["‰∏çÂÆâ", "Èùô„Åë„Åï"] },
          { text: "„Å≤„Å†„Åæ„Çä„ÅÆÈªÑËâ≤", tags: ["ÂÆâÂøÉ", "„ÇÑ„Åï„Åó„Åï"] },
          { text: "Èùô„Åë„Åï„ÅÆ‰∏≠„ÅÆÁôΩ", tags: ["Á©è„ÇÑ„Åã„Åï", "ÂÜÖÁúÅ"] },
          { text: "„Å´„Åò„Çì„Å†Ëµ§", tags: ["Êè∫„Çâ„Åé", "Ëø∑„ÅÑ"] }
        ]
      },
      // ‰ªñ„ÅÆË≥™Âïè„ÇÇÁ∂ö„ÅèÔºàÁúÅÁï•„Åõ„Åö„Å´Êú¨Áï™Áí∞Â¢É„Åß„ÅØÂøÖË¶ÅÔºâ
    ];

    const tagMessages = {
      "‰∏çÂÆâ": "Èúß„ÅÆ‰∏≠„Åß„ÇÇ„ÄÅ„ÅÇ„Å™„Åü„ÅØÊ≠©„ÅÑ„Å¶„Çã„ÄÇ",
      "Èùô„Åë„Åï": "Èùô„Åë„Åï„ÅÆ‰∏≠„Åß„Åó„Åã„ÄÅËÅû„Åì„Åà„Å™„ÅÑÂ£∞„Åå„ÅÇ„Çã„ÄÇ",
      "„ÇÑ„Åï„Åó„Åï": "„ÇÑ„Åï„Åó„Åè„ÅÑ„Çâ„Çå„Çã„Åì„Å®„ÄÅ„Åù„Çå„ÅØ‰Ωï„Çà„Çä„ÅÆÂº∑„Åï„ÄÇ",
      "ÂÆâÂøÉ": "„Åù„ÅÆÂøÉ„Å´ÂÆø„Çã„Å¨„Åè„ÇÇ„Çä„Åå„ÄÅ‰ªäÊó•„ÇíÂÑ™„Åó„ÅèÂåÖ„Çì„Åß„Åè„Çå„Çã„ÄÇ",
      "Ëø∑„ÅÑ": "„Åæ„Å£„Åô„Åê„Åò„ÇÉ„Å™„Åè„Å¶„ÅÑ„ÅÑ„Çà„ÄÇÊõ≤„Åå„ÇäÈÅì„Å´„ÇÇ„ÄÅÈ¢®„ÅØÂêπ„Åè„Åã„Çâ„ÄÇ",
      "„Å§„Å™„Åå„Çä": "ÂøÉ„ÅØÁõÆ„Å´Ë¶ã„Åà„Å™„ÅÑ„Åë„Çå„Å©„ÄÅ„Å°„ÇÉ„Çì„Å®Â±ä„ÅÑ„Å¶„Çã„Çà„ÄÇ",
      "ÂâçÈÄ≤": "Ê≠©ÂπÖ„ÅØÂ∞è„Åï„Åè„Å¶„ÇÇ„ÄÅÈÄ≤„Çì„Åß„ÅÑ„Çã„Åì„Å®„Å´Â§â„Çè„Çä„ÅØ„Å™„ÅÑ„ÄÇ",
      "Â∏åÊúõ": "„Å≤„Åã„Çä„ÅØ„ÄÅ„Å©„Çì„Å™„Å´Â∞è„Åï„Åè„Å¶„ÇÇÈÅì„ÇíÁÖß„Çâ„Åô„ÄÇ",
      "Ëá™Â∑±ÂèóÂÆπ": "Ë∂≥„Çä„Å™„ÅÑ„Å®„Åì„Çç„Åå„ÅÇ„Å£„Å¶„ÇÇ„ÄÅÊÑõ„Åó„Å¶„ÅÑ„ÅÑÂ≠òÂú®„Å™„Çì„Å†„Çà„ÄÇ",
      "Ëá™Â∑±Êé¢Ê±Ç": "„Åæ„Å†Áü•„Çâ„Å™„ÅÑ‚Äú„Çè„Åü„Åó‚Äù„Å´„ÄÅ„Åì„Çì„Å´„Å°„ÅØ„ÄÇ",
      "ÂèóÂÆπ": "„Åù„ÅÆ„Åæ„Åæ„ÅÆ„ÅÇ„Å™„Åü„ÇÇ„ÄÅ„Çà„Åè„ÇÑ„Å£„Å¶„ÅÑ„Çã„Çà„ÄÇ",
      "ÂÜÖÁúÅ": "Èùô„Åã„Å™ÊôÇÈñì„ÅÆ‰∏≠„Å´„ÄÅ„ÅÇ„Å™„Åü„Åå„ÅÑ„Çã„ÄÇ",
      "ÊåëÊà¶": "ÊÄñ„Åè„Å¶„ÇÇ„ÄÅÊâã„Çí‰º∏„Å∞„Åó„Åü„Åù„ÅÆÁû¨Èñì„Å´Â§âÂåñ„ÅØÂßã„Åæ„Çã„ÄÇ"
    };

    let currentQuestion = 0;
    let tagScores = {};
    let selectedChoice = null;

    const container = document.getElementById("question-container");
    const resultContainer = document.getElementById("result-container");
    const historyContainer = document.getElementById("history-container");
    const nextButton = document.getElementById("next-button");
    const historyButton = document.getElementById("history-button");

    function showQuestion() {
      container.innerHTML = "";
      selectedChoice = null;
      nextButton.style.display = "block";

      const q = questions[currentQuestion];

      const progress = document.createElement("p");
      progress.textContent = `Ôºà${currentQuestion + 1} / ${questions.length} ÂïèÁõÆÔºâ`;
      progress.style.fontWeight = "bold";
      progress.style.marginBottom = "10px";
      container.appendChild(progress);

      const qText = document.createElement("h2");
      qText.textContent = q.text;
      container.appendChild(qText);

      q.choices.forEach(choice => {
        const btn = document.createElement("button");
        btn.className = "choice";
        btn.textContent = choice.text;
        btn.onclick = () => {
          selectedChoice = choice;
          document.querySelectorAll(".choice").forEach(b => b.style.backgroundColor = "#fff");
          btn.style.backgroundColor = "#cceef2";
        };
        container.appendChild(btn);
      });
    }

    nextButton.onclick = () => {
      if (selectedChoice) {
        selectedChoice.tags.forEach(tag => {
          tagScores[tag] = (tagScores[tag] || 0) + 1;
        });
        currentQuestion++;
        if (currentQuestion < questions.length) {
          showQuestion();
        } else {
          showResult();
        }
      }
    };

    function showResult() {
      container.style.display = "none";
      nextButton.style.display = "none";
      resultContainer.style.display = "block";

      const topTags = Object.entries(tagScores)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 3)
        .map(([tag]) => tag);

      resultContainer.innerHTML = `<h2>„ÅÇ„Å™„Åü„Å´Âí≤„ÅÑ„Åü „Åì„Å®„ÅÆ„ÅØ</h2>`;
      const messages = topTags.map(tag => tagMessages[tag] || tag);

      messages.forEach(message => {
        const p = document.createElement("p");
        p.textContent = `üå±„Äå${message}„Äç`;
        resultContainer.appendChild(p);
      });

      const restartButton = document.createElement("button");
      restartButton.textContent = "„ÇÇ„ÅÜ‰∏ÄÂ∫¶Ë®∫Êñ≠„Åô„Çã";
      restartButton.onclick = () => location.reload();
      resultContainer.appendChild(restartButton);

      const shareButton = document.createElement("button");
      shareButton.textContent = "ÁµêÊûú„ÇíX(Twitter)„ÅßÂÖ±Êúâ";
      shareButton.onclick = () => {
        const text = encodeURIComponent(`„Åì„Å®„ÅÆ„ÅØË®∫Êñ≠„ÅÆÁµêÊûúÔºö\n${messages.map(m => 'üå±„Äå' + m + '„Äç').join('\n')}\n#„Åì„Å®„ÅÆ„ÅØË®∫Êñ≠`);
        const url = encodeURIComponent(location.href);
        const twitterUrl = `https://twitter.com/intent/tweet?text=${text}&url=${url}`;
        window.open(twitterUrl, '_blank');
      };
      resultContainer.appendChild(shareButton);

      const history = JSON.parse(localStorage.getItem("kotonohaHistory") || "[]");
      history.push({
        date: new Date().toLocaleString(),
        tags: topTags,
        messages: messages
      });
      localStorage.setItem("kotonohaHistory", JSON.stringify(history));
    }

    historyButton.onclick = () => {
      container.style.display = "none";
      resultContainer.style.display = "none";
      historyContainer.style.display = "block";
      historyContainer.innerHTML = "<h2>Ë®∫Êñ≠Â±•Ê≠¥</h2>";
      const history = JSON.parse(localStorage.getItem("kotonohaHistory") || "[]");
      if (history.length === 0) {
        historyContainer.innerHTML += "<p>Â±•Ê≠¥„ÅØ„Åæ„Å†„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>";
      } else {
        const ul = document.createElement("ul");
        history.forEach(entry => {
          const li = document.createElement("li");
          const messagesText = entry.messages ? entry.messages.join(" / ") : "";
          li.textContent = `${entry.date}Ôºö${messagesText}`;
          ul.appendChild(li);
        });
        historyContainer.appendChild(ul);

        const clearBtn = document.createElement("button");
        clearBtn.textContent = "Â±•Ê≠¥„Çí„Åô„Åπ„Å¶ÂâäÈô§";
        clearBtn.onclick = () => {
          localStorage.removeItem("kotonohaHistory");
          alert("Â±•Ê≠¥„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü");
          location.reload();
        };
        historyContainer.appendChild(clearBtn);
      }
    };

    document.getElementById("start-button").onclick = () => {
      document.getElementById("start-container").style.display = "none";
      document.getElementById("question-container").style.display = "block";
      showQuestion();
    };
  </script>
</body>
</html>
